(function(d){var a=d.telerik;a.combobox=function(g,h){this.element=g;this.$element=d(g);this.$text=this.$element.find("> .t-dropdown-wrap > .t-input");d.extend(this,h);var f=this.data?this.data.length:0;var e=this.index;a.dropDownList.initialize(this);if(!this.isAjax()&&f>0&&e<f&&e!=-1){a.dropDownList.updateTextAndValue(this,this.data[e])}this.$text.bind({change:d.proxy(function(i){i.stopPropagation()},this),keydown:d.proxy(this.keydown,this),keypress:d.proxy(function(j){var i=j.keyCode||j.charCode;if(i==0||d.inArray(i,a.dropDownList.keycodes)!=-1){return true}this.value(this.$text.val()+String.fromCharCode(i));this.resetTimer()},this),focus:d.proxy(function(j){if(!this.$dropDown){this.dropDown(a.dropDownList.open)}else{a.dropDownList.open(this)}var i=this.$text;a.combobox.selection(i[0],0,i.val().length)},this)});this.$element.bind({beforeOpen:d.proxy(function(){var j=this.data;if(j.length==0){return}var m=this.$text.val();var l=this.selectedIndex;if(l!=-1&&this.isFiltered){if(m==j[l].Text){this.filteredDataIndexes=[];var k=this.$dropDown;var i=d(a.dropDownList.itemsHtml(this.data,[]));k.find("> ul").html(i);k.css("height",i.length>10?this.dropDownHeight:"auto");this.$items=i;this.select(i[l])}else{this.filters[this.filter](this,this.data,m)}this.isFiltered=false}},this),selectOnDataBinding:d.proxy(function(l){var i=this.$items;var j=l.selectedIndex;var k=l.selectedItemsList;var m=k.length;var n=j!=-1&&j<i.length?i[j]:m>0?k[m-1]:this.highlightFirst?i[0]:null;this.selectedIndex=-1;if(n){this.select(n)}this.previousValue=this.value()},this)}).find("> .t-dropdown-wrap > .t-select").click(d.proxy(function(i){if(!this.isOpened()){this.$text[0].focus()}else{a.dropDownList.close(this)}},this))};d.extend(a.combobox,{moveToEnd:function(e){if(e.createTextRange){var f=e.createTextRange();f.moveStart("textedit",1);f.select()}},valueArrayIndex:function(e,f){return e.value.substring(0,a.caretPos(e)).split(f).length-1},selection:function(e,h,f){if(e.createTextRange){var g=e.createTextRange();g.collapse(true);g.moveStart("character",h);g.moveEnd("character",f-h);g.select()}else{if(e.selectionStart){e.selectionStart=h;e.selectionEnd=f}}},autoFill:function(n,j){if(n.autoFill&&(n.lastKeyCode!=8&&n.lastKeyCode!=46)){var q=n.$text[0];var e=q.value;var o=n.separator;var k=a.caretPos(q);var g=o?a.lastIndexOf(e.substring(0,k),o):-1;var l=g!=-1?g+o.length:0;var h=e.substring(l,k);var p=j.toLowerCase().indexOf(h.toLowerCase());if(p!=-1){var m=j.substring(p+h.length);var f=a.combobox.valueArrayIndex(q,o);var i=e.split(o);i[f]=h+m;q.value=i.join(o)+(n.multiple&&f!=0&&f==i.length-1?o:"");a.combobox.selection(q,k,k+m.length)}}},filter:function(e){e.isFiltered=true;var f=true;var j=e.data;var h=e.$text[0];var o=h.value;if(e.multiple){o=o.split(e.separator);o=o[a.combobox.valueArrayIndex(h,e.separator)]}if(o.length<e.minChars){return}var g=e.filter;if(e.isAjax()&&g>0){f=true;if(e.cache&&j&&j.length>0){if(!e.$dropDown){e.dropDown()}e.filters[g](e,j,o);if(e.filteredDataIndexes.length>0){f=false}}if(f){var n={};n[e.queryString.text]=o;e.ajaxRequest(function(r){if(!r){return}if(!e.$dropDown){e.dataBind()}e.data=r;a.trigger(e.element,"dataBound");e.filters[g](e,r,o);var p=e.$items;var q=p.length;e.$dropDown.css("height",q>10?e.dropDownHeight:"auto");if(q>0){if(!e.isOpened()){a.dropDownList.open(e)}a.combobox.autoFill(e,p.first().text())}else{a.dropDownList.close(e)}},{data:n})}}else{f=false;if(!e.$dropDown){e.dropDown()}e.filters[g](e,e.data,o)}if(!f){var m=e.$items;var l=m.length;var k=e.selectedIndex;e.$dropDown.css("height",l>10?e.dropDownHeight:"auto");var i=g==0?k!=-1?m[k].innerText||m[k].textContent:"":m.length>0?m.first().text():"";a.combobox.autoFill(e,i);if(l==0){a.dropDownList.close(e)}else{if(!e.isOpened()){a.dropDownList.open(e)}}}}});a.combobox.prototype=new a.dropDownList;d.extend(a.combobox.prototype,{text:function(){return this.$text.val(arguments[0])},select:function(f){var e=this.highlight(f);if(e==-1){return}var g=this.filteredDataIndexes;this.selectedIndex=(g&&g.length)>0?g[e]:e;a.dropDownList.updateTextAndValue(this,this.data[this.selectedIndex])},ensureData:function(e){var i=this.minChars;var h=this.$text.val();var g=h.length;if(this.isAjax()&&g>=i){var f={};f[this.queryString.text]=h;this.ajaxRequest(function(j){this.dataBind(j);a.trigger(this.element,"dataBound");if(e){e(this)}},{data:f})}if(!this.data){this.data=[]}},resetTimer:function(){clearTimeout(this.timeout);this.timeout=setTimeout(d.proxy(function(){a.combobox.filter(this)},this),this.delay)},keydown:function(l){var i=l.keyCode||l.which;this.lastKeyCode=i;if(l.altKey&&i==38){a.dropDownList.close(this);return}if(l.altKey&&i==40){a.dropDownList.open(this);return}if(!l.shiftKey&&(i==38||i==40)){l.preventDefault();if(!this.$items){this.dropDown()}var g=this.$items;var j=g.filter(".t-state-selected:first");var f=j.length==0||g.length==1?g.first():(i==38)?j.prev():(i==40)?j.next():[];if(f.length){var m=f[0];this.select(m);this.scrollTo(m);if(!this.isOpened()){a.dropDownList.change(this)}}}if(i==8||i==46){var h=this.$text;if(h.val()!=""){this.resetTimer()}setTimeout(d.proxy(function(){if(h.val()==""){this.selectedIndex=-1;this.value("")}else{this.value(this.$text.val())}},this),0)}if(i==13){var k=this.$items.filter(".t-state-selected:first");if(k.length>0){this.select(k[0]);a.dropDownList.change(this);a.dropDownList.close(this);a.combobox.moveToEnd(this.$text[0])}}if(i==27||i==9){a.dropDownList.change(this);a.dropDownList.close(this);if(i==27){this.$text.blur()}}},filters:[function(e,h,l){if(!h||h.length==0){return}var g=e.$items;for(var f=0,k=h.length;f<k;f++){if(h[f].Text.slice(0,l.length).toLowerCase()==l.toLowerCase()){var j=d(g[f]);g.removeClass("t-state-selected");j.addClass("t-state-selected");e.selectedIndex=f;e.scrollTo(g[f]);return}}g.removeClass("t-state-selected");e.selectedIndex=-1;b(e,g)},c(false,function(f,e){return e.slice(0,f.length).toLowerCase()==f.toLowerCase()}),c(true,function(f,e){return e&&e.toLowerCase().indexOf(f.toLowerCase())!=-1})]});function c(e,f){return function(h,l,m){if(!l||l.length==0){return}var k=d.map(h.data,function(o,n){if(f(m,o.Text||o)){return n}});var j=k.length;var g=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+m.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)",e?"ig":"i");var i=j>0?d(a.dropDownList.itemsHtml(h.data,k,g)):k;h.$dropDown.find("> ul").html(i);h.filteredDataIndexes=k;h.$items=i;h.selectedIndex=-1;if(j>0){i.removeClass("t-state-selected");b(h,i)}}}function b(f,e){if(f.highlightFirst){e.first().addClass("t-state-selected");f.scrollTo(e[0])}}d.fn.tComboBox=function(e){return a.create(this,{name:"tComboBox",init:function(f,g){return new a.combobox(f,g)},options:e})};d.fn.tComboBox.defaults={effects:a.fx.slide.defaults(),index:-1,filter:0,delay:200,minChars:0,cache:true,autoFill:true,highlightFirst:true,queryString:{text:"text"}}})(jQuery);