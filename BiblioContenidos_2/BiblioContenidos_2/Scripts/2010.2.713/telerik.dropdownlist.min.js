(function(c){var a=c.telerik;function b(d,f,h){if(!d||!f){return null}var j=h.length;h=h.toLowerCase();for(var e=0,g=d.length;e<g;e++){if(d[e].Text.slice(0,j).toLowerCase()==h){return f[e]}}}a.dropDownList=function(f,g){c.extend(this,g);this.element=f;this.$element=c(f);this.$text=this.$element.find("> .t-dropdown-wrap > .t-input");this.cachedInput="";if(!this.$element.attr("tabIndex")){this.$element.attr("tabIndex",0)}a.dropDownList.initialize(this);var e=this.data?this.data.length:0;var d=this.index;if(!this.isAjax()&&e>0&&d<e){a.dropDownList.updateTextAndValue(this,this.data[d==-1?0:d])}this.$element.bind({keypress:c.proxy(this.keypress,this),keydown:c.proxy(this.keydown,this),click:c.proxy(function(h){this.$element.focus();if(!this.isOpened()){if(!this.$dropDown){this.dropDown(a.dropDownList.open)}else{a.dropDownList.open(this)}}else{a.dropDownList.close(this)}},this),selectOnDataBinding:c.proxy(function(k){var i=k.selectedIndex;var j=k.selectedItemsList;var h=this.$items;var l=j.length;var m=i!=-1&&i<h.length?h[i]:l>0?j[l-1]:h[0];this.select(m);this.previousValue=this.value()},this)})};c.extend(a.dropDownList,{initialize:function(e){var d=e.$element;e.$input=d.find("#"+d.attr("id")+"-value");a.bind(e,{dataBinding:e.onDataBinding,dataBound:e.onDataBound,error:e.onError,open:e.onOpen,close:e.onClose,change:e.onChange,load:e.onLoad});c(document).bind("mousedown",c.proxy(function(h){var f=e.$dropDown;var g=f&&f.parent().length>0;if(g&&!c.contains(e.element,h.target)&&!c.contains(f.parent()[0],h.target)){a.dropDownList.change(e);a.dropDownList.close(e)}},e))},dropDownHtml:function(e,d){return c(new a.stringBuilder().cat("<div ").catIf(d,d).cat(' class="t-popup t-group"><ul class="t-reset">').cat(a.dropDownList.itemsHtml(e,[])).cat("</ul></div>").string())},itemsHtml:function(k,e,l){var h=new a.stringBuilder();if(k){var j=e.length>0;var m=j?e.length:k.length;for(var d=0;d<m;d++){var g=k[j?e[d]:d];var f=g.Text||g;h.cat('<li class="t-item').catIf(" t-state-selected",g.Selected).cat('">').cat(l?f.replace(l,"<strong>$1</strong>"):f).cat("</li>")}}return h.string()},updateTextAndValue:function(g,e){var d=e.Text;var f=e.Value;g.text(d);g.value((f||f==0)?f:d)},change:function(f){var d=f.value();var e=f.previousValue;if(e==undefined||d!=e){a.trigger(f.element,"change",{value:d})}f.previousValue=d},open:function(d){if(!d.isOpened()&&!a.trigger(d.element,"open")){c.proxy(d.open(),d)}},close:function(d){if(d.isOpened()&&!a.trigger(d.element,"close")){d.close()}},keycodes:[8,9,13,27,37,38,39,40,35,36,46]});a.dropDownList.prototype={dropDown:function(d){if(!this.$dropDown){this.ensureData(d);if(!this.isAjax()){this.dataBind(this.data);if(d){d(this)}}}return this.$dropDown},open:function(){if(this.data.length==0||this.isOpened()){return}var d=this.dropDown();if(!d){this.dropDown(a.dropDownList.open);return}var e=".t-reset > .t-item";var g=this.$element;a.trigger(this.element,"beforeOpen");d.delegate(e,"mouseenter",a.hover).delegate(e,"mouseleave",a.leave).delegate(e,"click",c.proxy(function(h){this.select(h.target);a.dropDownList.change(this);a.dropDownList.close(this)},this)).appendTo(document.body);var f=g.offset();f.top+=g.outerHeight();a.fx._wrap(d).css(c.extend({position:"absolute",zIndex:g.css("zIndex")},f));a.fx.play(this.effects,d,{direction:"bottom"},c.proxy(function(){var h=this.selectedIndex;if((h||h==0)&&h!=-1){this.scrollTo(this.$items[h])}},this))},close:function(){var d=this.dropDown();a.fx.rewind(this.effects,d,{direction:"bottom"},function(){d.parent().remove()})},highlight:function(f){var d=this.$items||this.dropDown().find("> .t-reset > .t-item");d.removeClass("t-state-selected");var e=c(f).addClass("t-state-selected");return d.index(e)},select:function(e){var d=this.highlight(e);if(d==-1){return}this.selectedIndex=d;a.dropDownList.updateTextAndValue(this,this.data[d])},text:function(){return this.$text.html(arguments[0])},value:function(){return this.$input.val(arguments[0])},dataBind:function(g){this.data=g||[];var e=this.dropDownAttr||"";var f=a.dropDownList.dropDownHtml(this.data,e).hide();var d=f.find(".t-reset > .t-item");this.$items=d;if(e.indexOf("width:")==-1){f.css("width",this.$element.outerWidth()-2)}if(e.indexOf("overflow-y:")==-1){f.css("overflow-y","auto")}this.dropDownHeight=e.indexOf("height:")==-1?200:f.css("height");f.css("height",d.length>10?this.dropDownHeight:"auto");if(d.length>0){a.trigger(this.element,"selectOnDataBinding",{selectedIndex:this.index,selectedItemsList:d.filter(".t-state-selected")})}this.$dropDown=f},ensureData:function(d){if(this.isAjax()){this.ajaxRequest(function(e){this.dataBind(e);a.trigger(this.element,"dataBound");if(d){d(this)}})}if(!this.data){this.data=[]}},isAjax:function(){return this.ajax||this.ws||this.onDataBinding},ajaxOptions:function(d,f){var e={url:(this.ajax||this.ws)["selectUrl"],type:"POST",data:{},dataType:"text",error:c.proxy(function(h,g){if(a.ajaxError(this.element,"error",h,g)){return}},this),complete:c.proxy(this.hideBusy,this),success:c.proxy(function(h,i,g){try{h=eval("("+h+")")}catch(j){if(!a.ajaxError(this.element,"error",g,"parseeror")){alert("Error! The requested URL did not return JSON.")}return}h=h.d||h;if(d){d.call(this,h)}},this)};c.extend(e,f);if(this.ws){e.data=a.toJson(e.data);e.contentType="application/json; charset=utf-8"}return e},ajaxRequest:function(d,f){var g={};if(a.trigger(this.element,"dataBinding",g)){return}if(this.ajax||this.ws){this.showBusy();c.ajax(this.ajaxOptions(d,{data:c.extend({},f?f.data:{},g.data)}))}else{if(d){d.call(this,this.data)}}},showBusy:function(){this.busyTimeout=setTimeout(c.proxy(function(){this.$element.find("> .t-dropdown-wrap .t-icon").addClass("t-loading")},this),100)},hideBusy:function(){clearTimeout(this.busyTimeout);this.$element.find("> .t-dropdown-wrap .t-icon").removeClass("t-loading")},keypress:function(h){var d=h.keyCode||h.charCode;if(d==0||c.inArray(d,a.dropDownList.keycodes)!=-1||h.ctrlKey||h.altKey||h.shiftKey){return}if(!this.$items){this.dropDown();return}var f=this.cachedInput;f+=String.fromCharCode(d);if(f){var g=b(this.data,this.$items,f);if(g){this.select(g);this.scrollTo(g)}this.cachedInput=f}this.resetTimer()},resetTimer:function(){clearTimeout(this.timeout);this.timeout=setTimeout(c.proxy(function(){this.cachedInput=""},this),1000)},keydown:function(i){var g=i.keyCode||i.which;if(i.altKey&&g==38){a.dropDownList.close(this);return}if(i.altKey&&g==40){a.dropDownList.open(this);return}if(g>34&&g<41){i.preventDefault();if(!this.$items){this.dropDown();return}var f=this.$items;var h=c(f[this.selectedIndex]);var d=(g==35)?f.last():(g==36)?f.first():(g==37||g==38)?h.prev():(g==39||g==40)?h.next():[];if(d.length){var j=d[0];this.select(j);this.scrollTo(j);if(!this.isOpened()){a.dropDownList.change(this)}}}if(g==8){this.resetTimer();i.preventDefault();this.cachedInput=this.cachedInput.slice(0,-1)}if(g==9||g==13||g==27){a.dropDownList.change(this);a.dropDownList.close(this)}},isOpened:function(){var d=this.$dropDown;return d&&d.is(":visible")},scrollTo:function(j){var d=j.offsetTop;var h=j.offsetHeight;var e=this.dropDown()[0];var f=e.scrollTop;var i=e.clientHeight;var g=d+h;e.scrollTop=f>d?d:g>(f+i)?g-i:f}};c.fn.tDropDownList=function(d){return a.create(this,{name:"tDropDownList",init:function(e,f){return new a.dropDownList(e,f)},options:d})};c.fn.tDropDownList.defaults={effects:a.fx.slide.defaults(),index:-1}})(jQuery);