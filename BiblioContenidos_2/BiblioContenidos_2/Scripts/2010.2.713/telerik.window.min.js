(function(a){var b=a.telerik;b.window=function(c,d){this.element=c;var e=a(c);if(!e.is(".t-window")){e.addClass("t-widget t-window");b.window.create(c,d)}a.extend(this,d);a(".t-window-titlebar",this.element).live("dblclick",a.proxy(this.toggleMaximization,this));a(".t-window-titlebar .t-window-action",this.element).live("mouseenter",b.hover).live("mouseleave",b.leave).live("click",a.proxy(this.windowActionHandler,this));if(this.resizable){e.append(b.window.getResizeHandlesHtml());b.draganddrop(this.element.id+"Resize",a.extend({draggables:a(".t-resize-handle",c),hitTestOffset:0},b.draganddrop.applyContext(b.draganddrop.windowResize,this)))}if(this.draggable){b.draganddrop(this.element.id+"Move",a.extend({draggables:a(".t-window-titlebar",c)},b.draganddrop.applyContext(b.draganddrop.windowMove,this)))}b.bind(this,{open:this.onOpen,close:this.onClose,refresh:this.onRefresh,resize:this.onResize,error:this.onError,load:this.onLoad,move:this.onMove});if(!e.parent().is("body")){e.css(e.offset()).appendTo(document.body)}if(this.modal&&a("body > .t-overlay").length==0){a('<div class="t-overlay" />').toggle(e.is(":visible")).appendTo(document.body)}a(window).resize(a.proxy(this.onDocumentResize,this));b.trigger(e,"load");if(this.contentUrl){this.ajaxRequest()}};b.window.prototype={windowActionHandler:function(f){var d=a(f.target).closest(".t-window-action").find(".t-icon");var c=this;a.each({"t-close":this.close,"t-maximize":this.maximize,"t-restore":this.restore,"t-refresh":this.refresh},function(g,e){if(d.hasClass(g)){f.preventDefault();e.call(c);return false}})},center:function(){var c=a(this.element);var d=document.body;c.css({left:(a(window).width()-c.width())/2,top:(a(window).height()-c.height())/2});return this},open:function(g){var d=a(this.element);if(!d.is(":visible")){if(!b.trigger(this.element,"open")){if(this.modal){if(this.animation){a("body > .t-overlay").css("opacity",0).show().animate({opacity:0.5},"fast")}else{a("body > .t-overlay").show()}this.center()}var f=d.find("> .t-window-content");if(!this.animation){d.show();return this}d.css("opacity",0).show();var c={width:f.width(),height:f.height(),left:parseInt(d.css("left")),top:parseInt(d.css("top"))};d.css({left:c.left+20,top:c.top+20}).animate({opacity:1,left:c.left,top:c.top},"fast",function(){this.style.cssText=this.style.cssText.replace(/filter.*?\;/ig,"")});f.css({width:c.width-40,height:c.height-40}).animate({width:c.width,height:c.height},"fast")}}return this},close:function(g){var d=a(this.element);if(d.is(":visible")){if(!b.trigger(this.element,"close")){if(!this.animation){a("body > .t-overlay").add(d[0]).hide();return}var f=d.find("> .t-window-content");var c={width:f.width(),height:f.height(),left:parseInt(d.css("left")),top:parseInt(d.css("top"))};a("body > .t-overlay").animate({opacity:0},"fast");f.animate({width:c.width-40,height:c.height-40},"fast");d.animate({opacity:0,left:c.left+20,top:c.top+20},"fast",function(){a("body > .t-overlay").add(d[0]).hide();d.css({left:c.left,top:c.top});f.width(c.width).height(c.height)})}}return this},toggleMaximization:function(c){if(c&&a(c.target).closest(".t-window-action").length>0){return}this[this.isMaximized?"restore":"maximize"]()},restore:function(){if(!this.isMaximized){return}a(this.element).css({position:"absolute",left:this.restorationSettings.left,top:this.restorationSettings.top}).find("> .t-window-content").css({width:this.restorationSettings.width,height:this.restorationSettings.height}).end().find(".t-resize-handle").show().end().find(".t-window-titlebar .t-restore").addClass("t-maximize").removeClass("t-restore");a("html, body").css("overflow","");this.isMaximized=false;b.trigger(this.element,"resize");return this},maximize:function(f){if(this.isMaximized){return}var c=a(this.element);var d=c.find("> .t-window-content");this.restorationSettings={left:c.position().left,top:c.position().top,width:d.width(),height:d.height()};c.css({left:0,top:0,position:"fixed"}).find(".t-resize-handle").hide().end().find(".t-window-titlebar .t-maximize").addClass("t-restore").removeClass("t-maximize");a("html, body").css("overflow","hidden");this.isMaximized=true;this.onDocumentResize();return this},onDocumentResize:function(){if(!this.isMaximized){return}var c=a(this.element);var d=c.find("> .t-window-content");d.css({width:a(window).width()-(d.outerWidth()-d.width()+c.outerWidth()-c.width()),height:a(window).height()-(d.outerHeight()-d.height()+c.outerHeight()-c.height()+c.find("> .t-window-titlebar").outerHeight())});b.trigger(this.element,"resize")},refresh:function(){this.ajaxRequest();return this},ajaxRequest:function(c){var e=setTimeout(function(){a(".t-refresh",this.element).addClass("t-loading")},100);var d={};a.ajax({type:"GET",url:c||this.contentUrl,dataType:"html",data:d,error:a.proxy(function(g,f){if(b.ajaxError(this.element,"error",g,f)){return}},this),complete:function(){clearTimeout(e);a(".t-refresh",this.element).removeClass("t-loading")},success:a.proxy(function(f,g){a(".t-window-content",this.element).html(f);b.trigger(this.element,"refresh")},this)})},destroy:function(){a(this.element).remove();if(this.modal){a("body > .t-overlay").remove()}}};a.extend(b.draganddrop,{windowMove:{shouldDrag:function(c){return !this.isMaximized&&c.closest(".t-window-action").length==0},onDragStart:function(c,d){this.initialWindowPosition=a(this.element).position();this.startPosition={left:c.pageX-this.initialWindowPosition.left,top:c.pageY-this.initialWindowPosition.top};a(".t-resize-handle",this.element).hide();a('<div class="t-overlay" />').appendTo(this.element);a(document.body).css("cursor",d.css("cursor"))},onDragMove:function(d){var c={left:d.pageX-this.startPosition.left,top:Math.max(d.pageY-this.startPosition.top,0)};a(this.element).css(c)},onDragCancelled:function(c,d){a(".t-resize-handle",this.element).show();a(".t-overlay",this.element).remove();a(document.body).css("cursor","");d.closest(".t-window").css(this.initialWindowPosition)},onDrop:function(d,f,c){a(".t-resize-handle",this.element).show();a(".t-overlay",this.element).remove();a(document.body).css("cursor","");return true}},windowResize:{shouldDrag:function(c){return true},onDragStart:function(c,d){this.initialCursorPosition=a(this.element).offset();this.resizeDirection=d[0].className.replace("t-resize-handle t-resize-","").split("");this.resizeElement=a(this.element).find("> .t-window-content");this.initialSize={width:this.resizeElement.width(),height:this.resizeElement.height()};this.outlineSize={left:this.resizeElement.outerWidth()-this.resizeElement.width()+a(this.element).outerWidth()-a(this.element).width(),top:this.resizeElement.outerHeight()-this.resizeElement.height()+a(this.element).outerHeight()-a(this.element).height()+a(this.element).find("> .t-window-titlebar").outerHeight()};a('<div class="t-overlay" />').appendTo(this.element);a(".t-resize-handle",this.element).not(d).hide();a(document.body).css("cursor",d.css("cursor"))},onDragMove:function(d,f){var c={e:function(){this.resizeElement.width(Math.max(d.pageX-this.initialCursorPosition.left-this.outlineSize.left,this.minWidth||50))},s:function(){this.resizeElement.height(Math.max(d.pageY-this.initialCursorPosition.top-this.outlineSize.top,this.minHeight||50))},w:function(){var e=this.initialCursorPosition.left+this.initialSize.width;a(this.element).css("left",Math.min(d.pageX,e-this.minWidth));this.resizeElement.width(Math.max(e-d.pageX,this.minWidth))},n:function(){var e=this.initialCursorPosition.top+this.initialSize.height;a(this.element).css("top",Math.min(d.pageY,e-this.minHeight));this.resizeElement.height(Math.max(e-d.pageY,this.minHeight))}};a.each(this.resizeDirection,a.proxy(function(g,e){a.proxy(c[e],this)()},this));b.trigger(this.element,"resize")},onDragCancelled:function(c,d){a(".t-resize-handle",this.element).not(d).show();a(".t-overlay",this.element).remove();a(document.body).css("cursor","");this.resizeElement.css(this.initialSize)},onDrop:function(d,f,c){a(".t-resize-handle",this.element).not(f).show();a(".t-overlay",this.element).remove();a(document.body).css("cursor","");return true}}});a.extend(b.window,{create:function(d,e){if(!d.nodeType){e=d;d=null}else{e.html=d.innerHTML}e=a.extend({title:"",html:"",actions:["Close"]},e);var c=new b.stringBuilder().catIf('<div class="t-widget t-window">',!d).cat('<div class="t-window-titlebar t-header">').cat('&nbsp;<span class="t-window-title">').cat(e.title).cat("</span>").cat('<div class="t-window-actions t-header">');a.map(e.actions,function(f){c.cat('<a href="#" class="t-window-action">').cat('<span class="t-icon t-').cat(f.toLowerCase()).cat('">').cat(f).cat("</span></a>")});c.cat("</div></div>").cat('<div class="t-window-content t-content" style="');if(e.width){c.cat("width:").cat(e.width).cat("px;")}if(e.height){c.cat("height:").cat(e.height).cat("px;")}c.cat('">').cat(e.html).cat("</div>").catIf("</div>",!d);if(d){a(d).html(c.string())}else{return a(c.string()).tWindow(e)}},getResizeHandlesHtml:function(){var c=new b.stringBuilder();a.each("n e s w se sw ne nw".split(" "),function(d,e){c.cat('<div class="t-resize-handle t-resize-').cat(e).cat('"></div>')});return c.string()}});a.fn.tWindow=function(c){return b.create(this,{name:"tWindow",init:function(d,e){return new b.window(d,e)},options:c})};a.fn.tWindow.defaults={modal:false,resizable:true,draggable:true}})(jQuery);